!======================================================================!
SUBROUTINE dayl
!----------------------------------------------------------------------!
USE params
use vars
!----------------------------------------------------------------------!
IMPLICIT NONE
!----------------------------------------------------------------------!
REAL :: sdec  ! Solar declination                              (degrees)
REAL :: x     ! Intermediate variable             (cosine of hour angle)
REAL :: ha    ! Hour angle of sunrise (sunset) from noon       (degrees)
!----------------------------------------------------------------------!
integer :: ikday
!----------------------------------------------------------------------!
DO ikday = 1, 365
  !--------------------------------------------------------------------!
  ! https://www.reuk.co.uk/wordpress/solar/solar-declination/
  !--------------------------------------------------------------------!
  sdec = asind (sind (-23.44) * cosd ((360.0 / 365.24) * &
         (float (ikday) + 10.0) + (360.0 / pi) * 0.0167 * &
         sind ((360.0 / 365.24) * (float (ikday) - 2.0))))
  !--------------------------------------------------------------------!
  ! https://physics.stackexchange.com/questions/28563/
  ! hours-of-light-per-day-based-on-latitude-longitude-formula/320092
  !--------------------------------------------------------------------!
  x = cosd (90.833) / (cosd (lat) * cosd (sdec) + eps) - &
      tand (lat) * tand (sdec)
  x = MAX (-1.0, x)
  x = MIN ( 1.0, x)
  !--------------------------------------------------------------------!
  ha = acosd (x) ! Hour angle of sunrise (sunset) from noon    (degrees)
  !--------------------------------------------------------------------!
  dlength (ikday) = 2.0 * ha / 15.0 ! Daylength                  (hours)
  !--------------------------------------------------------------------!
END DO ! kday = 1, ndays
!----------------------------------------------------------------------!
END SUBROUTINE dayl
!======================================================================!
